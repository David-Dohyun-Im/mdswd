---
lesson_id: "02-agent-tools-mcp"
lesson_title: "Agent Tools MCP"
source_dir: "reference-course/mastra/02-agent-tools-mcp"
step_count: 31
---

<!-- STEP:01 -->
## Step 01: Installing and Setting Up MCP

# Installing and Setting Up MCP

In this lesson, we'll learn how to enhance your Mastra agent with MCP (Model Context Protocol) servers. MCP allows your agent to access a wide range of external tools and services without having to write custom tool functions for each one.

## What is MCP?

MCP (Model Context Protocol) is a standard that allows AI models to access external tools and services through a consistent interface. By integrating MCP servers with your Mastra agent, you can give it access to:

- Email services like Gmail
- Code repositories like GitHub
- Social media platforms
- Weather information
- News sources
- File systems
- And many more services

## Step Quiz
**Questions**
1) What is MCP and why is it useful for agents?
**Answers**
1) MCP lets agents access external tools/services via standardized servers, expanding capabilities beyond built-in tools.

<!-- STEP:02 -->
## Step 02: Installing MCP

# Installing MCP

First, let's install the Mastra MCP package:

```bash
npm install @mastra/mcp@beta
```

The `@mastra/mcp` package provides the necessary infrastructure to connect your Mastra agent to various MCP servers. This package handles the communication between your agent and the MCP servers, allowing your agent to access the tools and services provided by those servers.

Installing this package is the first step in enhancing your agent with MCP capabilities. Once installed, you'll need to configure it to connect to specific MCP servers, which we'll cover in the next steps.

## Step Quiz
**Questions**
1) What is the main action you take in this step to install MCP?
**Answers**
1) Install the MCP tooling package(s) needed for the project using the recommended command.

<!-- STEP:03 -->
## Step 03: Setting Up MCP Configuration

# Setting Up MCP Configuration

Now, let's create a basic MCP configuration in your agent file. Open your `src/mastra/agents/index.ts` file and add the following imports:

```typescript
import { MCPClient } from "@mastra/mcp";
```

Then, create a basic MCP configuration object:

```typescript
const mcp = new MCPClient({
  servers: {
    // We'll add servers in the next steps
  },
});
```

This configuration object will be used to specify which MCP servers your agent should connect to. The `servers` property is an object where each key is a unique identifier for a server, and the value contains the configuration for that server.

In the upcoming steps, we'll add various MCP servers to this configuration, giving your agent access to a wide range of tools and services.

## Step Quiz
**Questions**
1) What does the MCP configuration file define?
**Answers**
1) It lists MCP servers (and their commands/URLs) the agent can connect to.

<!-- STEP:04 -->
## Step 04: Initializing MCP Tools

# Initializing MCP Tools

Once you have the configuration set up, you need to initialize the MCP tools:

```typescript
const mcpTools = await mcp.listTools();
```

This asynchronous call fetches all the available tools from the configured MCP servers. The `listTools()` method connects to each server specified in your configuration, retrieves the available tools, and returns them in a format that can be used by your Mastra agent.

The `mcpTools` object will contain all the tools provided by the MCP servers you've configured. We'll add these tools to our agent in the next step.

## Step Quiz
**Questions**
1) What is the purpose of initializing MCP tools in code?
**Answers**
1) To load the configured servers and expose their tools to the agent.

<!-- STEP:05 -->
## Step 05: Updating Your Agent

# Updating Your Agent

Let's update your agent to use the MCP tools. Modify your agent definition to include the MCP tools:

```typescript
export const personalAssistantAgent = new Agent({
  name: "Personal Assistant",
  instructions: `
    You are a helpful personal assistant that can help with various tasks.
    
    Keep your responses concise and friendly.
  `,
  model: "openai/gpt-4.1-mini",
  tools: { ...mcpTools }, // Add MCP tools to your agent
});
```

By spreading the `mcpTools` object into your agent's `tools` property, you're making all the tools from your configured MCP servers available to your agent. This allows your agent to access and use these tools when responding to user requests.

As we add more MCP servers in the upcoming steps, the `mcpTools` object will automatically include tools from those servers as well, giving your agent an expanding set of capabilities.

## Step Quiz
**Questions**
1) How do you connect MCP tools to the agent in this step?
**Answers**
1) Pass the initialized MCP tools into the agent's tools map when creating the agent.

<!-- STEP:06 -->
## Step 06: Testing Your Setup

# Testing Your Setup

At this point, your agent doesn't have any MCP servers configured yet, but the basic setup is in place. Let's test that everything is working:

1. Make sure your development server is running with `npm run dev`
2. Open the playground at http://localhost:4111/
3. You should see your "Personal Assistant" agent in the list of agents
4. Try sending a message like "Hello, what can you help me with?"

The agent should respond, but it won't have any special capabilities yet. In the next steps, we'll add various MCP servers to give your agent powerful new abilities.

In the next step, we'll add the Zapier MCP server to give your agent access to email and social media tools.

## Step Quiz
**Questions**
1) What should you verify when testing your MCP setup?
**Answers**
1) That the agent can call an MCP tool successfully and receive expected results.

<!-- STEP:07 -->
## Step 07: Adding the Zapier MCP Server

# Adding the Zapier MCP Server

In this step, we'll add the Zapier MCP server to our agent, which will give it access to email, social media, and many other integrations available through Zapier.

## What is Zapier MCP?

Zapier MCP is a server that provides access to thousands of apps and services through the Zapier platform. This includes:

- Email services (Gmail, Outlook, etc.)
- Social media platforms (Twitter/X, LinkedIn, etc.)
- Project management tools (Trello, Asana, etc.)
- And many more

By integrating the Zapier MCP server with your Mastra agent, you can give it access to all these services without having to write custom tool functions for each one. This significantly expands your agent's capabilities and makes it more useful for a wide range of tasks.

## Step Quiz
**Questions**
1) What problem does the Zapier MCP server solve here?
**Answers**
1) It provides access to automation actions across many apps without custom tool code.

<!-- STEP:08 -->
## Step 08: Getting a Zapier MCP URL

# Getting a Zapier MCP URL

First, you'll need to get a Zapier MCP URL. This typically requires:

1. Creating a Zapier account if you don't have one
2. Setting up the Zapier MCP integration by adding some tools (we will use Gmail in this example)
3. Getting your unique MCP URL

For this example, we'll use an environment variable to store the URL:

```bash
# Add this to your .env file
ZAPIER_MCP_URL=https://your-zapier-mcp-url.zapier.app
```

Using an environment variable is a good practice for storing sensitive information like API URLs. It keeps the URL out of your code, making it easier to manage and more secure. It also allows you to use different URLs for different environments (development, staging, production) without changing your code.

## Step Quiz
**Questions**
1) Where do you obtain the Zapier MCP server URL?
**Answers**
1) From the Zapier MCP setup page or dashboard after configuring the server.

<!-- STEP:09 -->
## Step 09: Updating Your MCP Configuration

# Updating Your MCP Configuration

Now, let's update your MCP configuration in `src/mastra/agents/index.ts` to include the Zapier server:

```typescript
const mcp = new MCPClient({
  servers: {
    zapier: {
      url: new URL(process.env.ZAPIER_MCP_URL || ""),
    },
  },
});
```

This configuration tells your agent how to connect to the Zapier MCP server. The `zapier` key is a unique identifier for this server in your configuration, and the `url` property specifies the URL of the Zapier MCP server.

The `new URL()` constructor creates a URL object from the string provided by the environment variable. The `|| ""` part provides a default empty string in case the environment variable is not set, which prevents your application from crashing if the environment variable is missing.

## Step Quiz
**Questions**
1) What change is required in mcp.json after adding Zapier?
**Answers**
1) Add a zapier server entry with its URL under the servers section.

<!-- STEP:10 -->
## Step 10: Updating Your Agent's Instructions

# Updating Your Agent's Instructions

Next, let's update your agent's instructions to include information about the Zapier tools:

```typescript
export const personalAssistantAgent = new Agent({
  name: "Personal Assistant",
  instructions: `
    You are a helpful personal assistant that can help with various tasks such as email 
    and scheduling social media posts.
    
    You have access to the following tools:
    
    1. Gmail:
       - Use these tools for reading and categorizing emails from Gmail
       - You can categorize emails by priority, identify action items, and summarize content
       - You can also use this tool to send emails
    
    Keep your responses concise and friendly.
  `,
  model: "openai/gpt-4.1-mini",
  tools: { ...mcpTools },
  memory,
});
```

Updating your agent's instructions is crucial for helping it understand when and how to use the tools available to it. By explicitly mentioning the Gmail tools in the instructions, you're giving your agent context about what these tools do and when to use them.

This helps the agent make better decisions about which tools to use when responding to user requests, resulting in more helpful and accurate responses.

## Step Quiz
**Questions**
1) Why update the agent's instructions after adding Zapier?
**Answers**
1) To tell the agent which new actions it can perform and when to use them.

<!-- STEP:11 -->
## Step 11: Testing the Zapier Integration

# Testing the Zapier Integration

Let's test the Zapier integration:

1. Make sure your development server is running with `npm run dev`
2. Open the playground at http://localhost:4111/
3. Try asking your agent to perform tasks that use Zapier, such as:
   - "Get my last email"
   - "Send an email to youremail@gmail.com with the subject 'Test' and body 'Hello, this is a test email'"

If everything is set up correctly, your agent should be able to use the Zapier tools to perform these tasks.

Testing your integration is an important step to ensure that your agent can properly access and use the Zapier tools. When you ask your agent to perform a task that requires Zapier, it should recognize the need to use the appropriate Zapier tool and make the necessary API calls to complete the task.

## Step Quiz
**Questions**
1) What indicates the Zapier integration is working?
**Answers**
1) The agent successfully triggers a Zapier action via the MCP tool.

<!-- STEP:12 -->
## Step 12: Troubleshooting

# Troubleshooting

If your agent can't access the Zapier tools, check:

1. That your Zapier MCP URL is correct in your environment variables
2. That you've properly set up the Zapier MCP integration
3. That the tools are properly loaded by checking the Tools tab in the playground

Common issues include:

- Incorrect or missing environment variables
- Network connectivity problems
- Authentication issues with the Zapier MCP server

If you're having trouble, try restarting your development server after making changes to your environment variables or configuration. This ensures that the changes are properly loaded.

In the next step, we'll add the GitHub MCP server to give your agent the ability to monitor and interact with GitHub repositories.

## Step Quiz
**Questions**
1) Name one first troubleshooting check for MCP tool failures.
**Answers**
1) Confirm the MCP server URL is correct and the server is reachable.

<!-- STEP:13 -->
## Step 13: Adding the GitHub MCP Server

# Adding the GitHub MCP Server

In this step, we'll add the Composio GitHub MCP server to our agent, which will give it the ability to monitor and interact with GitHub repositories.

## What is the GitHub MCP Server?

The GitHub MCP server provides tools for interacting with GitHub repositories, including:

- Monitoring repository activity
- Checking pull requests and issues
- Viewing commit history
- Summarizing development patterns

By integrating the GitHub MCP server with your Mastra agent, you can create an assistant that helps you stay on top of your GitHub repositories, track important changes, and get insights into development activity. This is particularly useful for developers and teams who want to monitor their projects without constantly checking GitHub manually.

## Step Quiz
**Questions**
1) What does the GitHub MCP server provide?
**Answers**
1) Tools to read or act on GitHub data such as repos, issues, or pull requests.

<!-- STEP:14 -->
## Step 14: Getting a Smithery GitHub MCP URL

# Getting a Smithery GitHub MCP URL

First, you'll need to get a Smithery GitHub MCP URL. This typically requires:

1. Setting up a Smithery account
2. Creating a personal access token with your GitHub account
3. Getting your unique MCP URL via the Smithery packages

For this example, we'll use an environment variable to store the Smithery API key and profile name which can be found in the Smithery interface.

```bash
# Add this to your .env file
SMITHERY_API_KEY=your_smithery_api_key
SMITHERY_PROFILE=your_smithery_profile_name
```

Using an environment variable keeps your configuration secure and flexible. It also prevents sensitive information from being committed to your repository.

We will use the Smithery packages to authenticate and create a streamable HTTP URL for the MCP server configuration

```bash
pnpm install @smithery/sdk
```

```ts
import { createSmitheryUrl } from "@smithery/sdk";

const smitheryGithubMCPServerUrl = createSmitheryUrl(
  "https://server.smithery.ai/@smithery-ai/github",
  {
    apiKey: process.env.SMITHERY_API_KEY,
    profile: process.env.SMITHERY_PROFILE,
  },
);
```

## Step Quiz
**Questions**
1) What is required to generate a Smithery GitHub MCP URL?
**Answers**
1) A Smithery profile and API key to provision the server URL.

<!-- STEP:15 -->
## Step 15: Updating Your MCP Configuration

# Updating Your MCP Configuration

Now, let's update your MCP configuration in `src/mastra/agents/index.ts` to include the GitHub server:

```typescript
const mcp = new MCPClient({
  servers: {
    zapier: {
      url: new URL(process.env.ZAPIER_MCP_URL || ""),
    },
    github: {
      url: smitheryGithubMCPServerUrl,
    },
  },
});
```

This configuration adds the GitHub MCP server alongside the Zapier server we added in the previous step. The `github` key is a unique identifier for this server in your configuration, and the `url` property specifies the URL of the GitHub MCP server.

By adding multiple servers to your MCP configuration, you're building a more versatile agent that can access a wider range of tools and services. Each server adds its own set of capabilities to your agent.

## Step Quiz
**Questions**
1) How is GitHub added to the MCP configuration?
**Answers**
1) Add a github server entry with its URL alongside other servers.

<!-- STEP:16 -->
## Step 16: Updating Your Agent's Instructions

# Updating Your Agent's Instructions

Next, let's update your agent's instructions to include information about the GitHub tools:

```typescript
export const personalAssistantAgent = new Agent({
  name: "Personal Assistant",
  instructions: `
    You are a helpful personal assistant that can help with various tasks such as email, 
    monitoring github activity, and scheduling social media posts.
    
    You have access to the following tools:
    
    1. Gmail:
       - Use these tools for reading and categorizing emails from Gmail
       - You can categorize emails by priority, identify action items, and summarize content
       - You can also use this tool to send emails
    
    2. GitHub:
       - Use these tools for monitoring and summarizing GitHub activity
       - You can summarize recent commits, pull requests, issues, and development patterns
    
    Keep your responses concise and friendly.
  `,
  model: "openai/gpt-4.1-mini",
  tools: { ...mcpTools },
  memory,
});
```

By updating your agent's instructions to include information about the GitHub tools, you're helping it understand when and how to use these tools. The instructions provide context about what the GitHub tools can do, such as monitoring repository activity, checking pull requests and issues, and summarizing development patterns.

This context helps your agent make better decisions about when to use the GitHub tools and how to interpret the results they provide.

## Step Quiz
**Questions**
1) Why refine instructions after adding GitHub tools?
**Answers**
1) So the agent knows which GitHub operations it should perform via MCP.

<!-- STEP:17 -->
## Step 17: Testing the GitHub Integration

# Testing the GitHub Integration

Let's test the GitHub integration:

1. Make sure your development server is running with `npm run dev`
2. Open the playground at http://localhost:4111/
3. Try asking your agent to perform GitHub-related tasks, such as:
   - "Check the recent activity on my repository"
   - "Summarize the open pull requests"
   - "What are the latest commits on the main branch?"
   - "Are there any issues that need my attention?"

If everything is set up correctly, your agent should be able to use the GitHub tools to provide this information.

Testing your GitHub integration helps ensure that your agent can properly access and use the GitHub tools. When you ask your agent about GitHub-related information, it should recognize the need to use the appropriate GitHub tool and make the necessary API calls to retrieve the requested information.

## Step Quiz
**Questions**
1) What is a successful GitHub integration test?
**Answers**
1) The agent can call a GitHub MCP tool and return real GitHub data.

<!-- STEP:18 -->
## Step 18: Troubleshooting

# Troubleshooting

If your agent can't access the GitHub tools, check:

1. That your GitHub MCP URL is correct in your environment variables
2. That you've properly authenticated with GitHub
3. That the tools are properly loaded by checking the Tools tab in the playground

Common issues include:

- Incorrect or missing environment variables
- Authentication issues with GitHub
- Permission problems with the repositories you're trying to access

If you're having trouble, try checking the console logs for any error messages related to the GitHub MCP server. These can provide valuable clues about what might be going wrong.

In the next step, we'll add the Hacker News MCP server to give your agent access to tech news and discussions.

## Step Quiz
**Questions**
1) What should you check if GitHub tool calls fail?
**Answers**
1) Verify the Smithery URL/API key and that the server is running.

<!-- STEP:19 -->
## Step 19: Adding the Hacker News MCP Server

# Adding the Hacker News MCP Server

In this step, we'll add a Hacker News MCP server to our agent, which will give it access to tech news and discussions from Hacker News.

## What is the Hacker News MCP Server?

The Hacker News MCP server provides tools for accessing content from Hacker News, including:

- Retrieving top stories
- Searching for specific stories
- Staying updated on tech trends and news

By integrating the Hacker News MCP server with your Mastra agent, you can create an assistant that helps you stay informed about the latest developments in technology, programming, and startups. This is particularly useful for developers, tech enthusiasts, and professionals who want to keep up with industry trends and discussions.

## Step Quiz
**Questions**
1) What is the role of the Hacker News MCP server?
**Answers**
1) It provides tools to fetch and summarize Hacker News stories.

<!-- STEP:20 -->
## Step 20: Updating Your MCP Configuration

# Updating Your MCP Configuration

Unlike the previous MCP servers that use URLs, the Hacker News MCP server can be run directly using NPX. This means we don't need to set up any external services or authentication.

Let's update your MCP configuration in `src/mastra/agents/index.ts` to include the Hacker News server:

```typescript
const mcp = new MCPClient({
  servers: {
    zapier: {
      url: new URL(process.env.ZAPIER_MCP_URL || ""),
    },
    github: {
      url: new URL(process.env.COMPOSIO_MCP_GITHUB || ""),
    },
    hackernews: {
      command: "npx",
      args: ["-y", "@devabdultech/hn-mcp-server"],
    },
  },
});
```

This configuration tells MCP to run the Hacker News server using NPX when needed. The `-y` flag automatically confirms any prompts, making it seamless to use.

Unlike the Zapier and GitHub servers that connect to external services via URLs, the Hacker News server is run locally using NPX. This approach is simpler because it doesn't require any authentication or external service setup.

## Step Quiz
**Questions**
1) What does the Hacker News server entry include in mcp.json?
**Answers**
1) A command and args to launch the MCP server.

<!-- STEP:21 -->
## Step 21: Updating Your Agent's Instructions

# Updating Your Agent's Instructions

Next, let's update your agent's instructions to include information about the Hacker News tools:

```typescript
export const personalAssistantAgent = new Agent({
  name: "Personal Assistant",
  instructions: `
    You are a helpful personal assistant that can help with various tasks such as email, 
    monitoring github activity, scheduling social media posts, and providing tech news.
    
    You have access to the following tools:
    
    1. Gmail:
       - Use these tools for reading and categorizing emails from Gmail
       - You can categorize emails by priority, identify action items, and summarize content
       - You can also use this tool to send emails
    
    2. GitHub:
       - Use these tools for monitoring and summarizing GitHub activity
       - You can summarize recent commits, pull requests, issues, and development patterns
    
    3. Hackernews:
       - Use this tool to search for stories on Hackernews
       - You can use it to get the top stories or specific stories
       - You can use it to retrieve comments for stories
    
    Keep your responses concise and friendly.
  `,
  model: "openai/gpt-4.1-mini",
  tools: { ...mcpTools },
  memory,
});
```

By updating your agent's instructions to include information about the Hacker News tools, you're helping it understand when and how to use these tools. The instructions provide context about what the Hacker News tools can do, such as searching for stories, retrieving top stories, and accessing comments.

This context helps your agent make better decisions about when to use the Hacker News tools and how to interpret the results they provide. When a user asks about tech news or specific topics on Hacker News, your agent will know to use these tools to provide relevant information.

## Step Quiz
**Questions**
1) Why update agent instructions for Hacker News?
**Answers**
1) To guide the agent to use HN tools for news lookups and summaries.

<!-- STEP:22 -->
## Step 22: Testing the Hacker News Integration

# Testing the Hacker News Integration

Let's test the Hacker News integration:

1. Make sure your development server is running with `npm run dev`
2. Open the playground at http://localhost:4111/
3. Try asking your agent to perform Hacker News-related tasks, such as:
   - "What are the top stories on Hacker News today?"
   - "Find Hacker News discussions about AI agents"
   - "Summarize the comments on the top story"
   - "What's trending in tech on Hacker News?"

The first time you ask a Hacker News-related question, there might be a slight delay as the NPX command installs and starts the server. Subsequent queries should be faster.

Testing your Hacker News integration helps ensure that your agent can properly access and use the Hacker News tools. When you ask your agent about tech news or specific topics on Hacker News, it should recognize the need to use the appropriate Hacker News tool and make the necessary API calls to retrieve the requested information.

## Step Quiz
**Questions**
1) What confirms the Hacker News integration works?
**Answers**
1) The agent returns recent HN stories using the MCP tool.

<!-- STEP:23 -->
## Step 23: Troubleshooting

# Troubleshooting

If your agent can't access the Hacker News tools, check:

1. That you have NPX installed and working properly
2. That your network allows NPX to download and run packages
3. That the tools are properly loaded by checking the Tools tab in the playground

Common issues include:

- NPX not being installed or configured properly
- Network restrictions preventing NPX from downloading packages
- Firewall or proxy settings blocking the Hacker News API

If you're having trouble, try running the NPX command manually in your terminal to see if it works:

```bash
npx -y @devabdultech/hn-mcp-server
```

This can help identify whether the issue is with NPX itself or with how it's being used in your Mastra configuration.

In the next step, we'll add the Filesystem MCP server to give your agent the ability to read and write files locally.

## Step Quiz
**Questions**
1) Name one common cause of MCP tool errors to rule out first.
**Answers**
1) Misconfigured server command/args or a server that isn't running.

<!-- STEP:24 -->
## Step 24: Adding the Filesystem MCP Server

# Adding the Filesystem MCP Server

In this final step, we'll add the Filesystem MCP server to our agent, which will give it the ability to read and write files on your local system. This is particularly useful for creating and managing notes, to-do lists, and other persistent data.

## What is the Filesystem MCP Server?

The Filesystem MCP server provides tools for interacting with your local file system, including:

- Reading files
- Writing to files
- Creating directories
- Listing files and directories
- Managing persistent data like notes and to-do lists

By integrating the Filesystem MCP server with your Mastra agent, you can create an assistant that can maintain persistent information across sessions. This allows your agent to create and manage notes, to-do lists, and other documents that persist even after you close the application.

## Step Quiz
**Questions**
1) What does the Filesystem MCP server enable?
**Answers**
1) Reading and writing files locally through MCP tools.

<!-- STEP:25 -->
## Step 25: Creating a Notes Directory

# Creating a Notes Directory

Like the Hacker News MCP server, the Filesystem MCP server can be run directly using a package manager. We'll use PNPX (the Pnpm version of NPX) to run it.

First, let's create a directory where our agent can store notes and other files:

```bash
mkdir -p notes
```

This command creates a directory called `notes` in your project's root directory. This is where your agent will store any files it creates or modifies. The `-p` flag ensures that the command doesn't fail if the directory already exists.

Creating a dedicated directory for your agent's files is a good practice for several reasons:

- It keeps your agent's files separate from your application code
- It makes it easier to backup or version control your agent's data
- It provides a clear boundary for what your agent can access, enhancing security

## Step Quiz
**Questions**
1) Why create a notes directory in this step?
**Answers**
1) To give the Filesystem MCP server a safe, scoped workspace for file operations.

<!-- STEP:26 -->
## Step 26: Updating Your MCP Configuration

# Updating Your MCP Configuration

Now, let's update your MCP configuration in `src/mastra/agents/index.ts` to include the Filesystem server:

```typescript
import path from "path";

const mcp = new MCPClient({
  servers: {
    zapier: {
      url: new URL(process.env.ZAPIER_MCP_URL || ""),
    },
    github: {
      url: new URL(process.env.COMPOSIO_MCP_GITHUB || ""),
    },
    hackernews: {
      command: "npx",
      args: ["-y", "@devabdultech/hn-mcp-server"],
    },
    textEditor: {
      command: "pnpx",
      args: [
        `@modelcontextprotocol/server-filesystem`,
        path.join(process.cwd(), "..", "..", "notes"), // relative to output directory
      ],
    },
  },
});
```

This configuration tells MCP to run the Filesystem server using PNPX, pointing it to the "notes" directory we created. The `path.join(process.cwd(), "notes")` ensures that the path is correct regardless of where the application is run from.

The `textEditor` key is a unique identifier for this server in your configuration. The `command` property specifies that we want to use PNPX to run the server, and the `args` property provides the arguments to pass to PNPX, including the package name and the path to the notes directory.

## Step Quiz
**Questions**
1) How do you register the Filesystem MCP server in config?
**Answers**
1) Add a server entry with its command and args pointing at the notes directory.

<!-- STEP:27 -->
## Step 27: Updating Your Agent's Instructions

# Updating Your Agent's Instructions

Next, let's update your agent's instructions to include information about the Filesystem tools:

```typescript
export const personalAssistantAgent = new Agent({
  name: "Personal Assistant",
  instructions: `
    You are a helpful personal assistant that can help with various tasks such as email, 
    monitoring github activity, scheduling social media posts, providing tech news,
    and managing notes and to-do lists.
    
    You have access to the following tools:
    
    1. Gmail:
       - Use these tools for reading and categorizing emails from Gmail
       - You can categorize emails by priority, identify action items, and summarize content
       - You can also use this tool to send emails
    
    2. GitHub:
       - Use these tools for monitoring and summarizing GitHub activity
       - You can summarize recent commits, pull requests, issues, and development patterns
    
    3. Hackernews:
       - Use this tool to search for stories on Hackernews
       - You can use it to get the top stories or specific stories
       - You can use it to retrieve comments for stories
    
    4. Filesystem:
       - You also have filesystem read/write access to a notes directory. 
       - You can use that to store info for later use or organize info for the user.
       - You can use this notes directory to keep track of to-do list items for the user.
       - Notes dir: ${path.join(process.cwd(), "notes")}
    
    Keep your responses concise and friendly.
  `,
  model: "openai/gpt-4.1-mini",
  tools: { ...mcpTools },
  memory,
});
```

By updating your agent's instructions to include information about the Filesystem tools, you're helping it understand when and how to use these tools. The instructions provide context about what the Filesystem tools can do, such as storing information for later use and keeping track of to-do list items.

This context helps your agent make better decisions about when to use the Filesystem tools and how to organize the information it stores. The inclusion of the notes directory path in the instructions ensures that your agent knows exactly where it can read from and write to.

## Step Quiz
**Questions**
1) What instruction change helps the agent use the Filesystem tools?
**Answers**
1) Explicitly state it can read/write notes and where they are stored.

<!-- STEP:28 -->
## Step 28: Testing the Filesystem Integration

# Testing the Filesystem Integration

Let's test the Filesystem integration:

1. Make sure your development server is running with `npm run dev`
2. Open the playground at http://localhost:4111/
3. Try asking your agent to perform Filesystem-related tasks, such as:
   - "Create a to-do list for me"
   - "Add 'Buy groceries' to my to-do list"
   - "Create a note about the meeting tomorrow"
   - "What's on my to-do list?"
   - "Read my meeting notes"

The first time you ask a Filesystem-related question, there might be a slight delay as the PNPX command installs and starts the server. Subsequent queries should be faster.

Testing your Filesystem integration helps ensure that your agent can properly access and use the Filesystem tools. When you ask your agent to create or manage notes and to-do lists, it should recognize the need to use the appropriate Filesystem tool and make the necessary API calls to read from or write to the file system.

## Step Quiz
**Questions**
1) What is a successful Filesystem integration test?
**Answers**
1) The agent creates or reads a file in the notes directory via MCP.

<!-- STEP:29 -->
## Step 29: Troubleshooting

# Troubleshooting

If your agent can't access the Filesystem tools, check:

1. That you have PNPX installed and working properly
2. That the "notes" directory exists in the correct location
3. That the tools are properly loaded by checking the Tools tab in the playground

Common issues include:

- PNPX not being installed or configured properly
- The notes directory not existing or having incorrect permissions
- Path issues in the MCP configuration

If you're having trouble, try running the PNPX command manually in your terminal to see if it works:

```bash
pnpx @modelcontextprotocol/server-filesystem ./notes
```

This can help identify whether the issue is with PNPX itself or with how it's being used in your Mastra configuration.

## Step Quiz
**Questions**
1) What is a quick troubleshooting step for file tool failures?
**Answers**
1) Confirm the path/args match the actual notes directory and permissions.

<!-- STEP:30 -->
## Step 30: Enhancing Memory Configuration

# Enhancing Memory Configuration

Finally, let's enhance our memory configuration to make our agent even more helpful:

```typescript
import { LibSQLStore, LibSQLVector } from "@mastra/libsql";

const memory = new Memory({
  storage: new LibSQLStore({
    id: "learning-memory-storage",
    url: "file:../../memory.db",
  }),
  vector: new LibSQLVector({
    id: "learning-memory-vector",
    connectionUrl: "file:../../memory.db",
  }),
  embedder: "openai/text-embedding-3-small",
  options: {
    // Keep last 20 messages in context
    lastMessages: 20,
    // Enable semantic search to find relevant past conversations
    semanticRecall: {
      topK: 3,
      messageRange: {
        before: 2,
        after: 1,
      },
    },
    // Enable working memory to remember user information
    workingMemory: {
      enabled: true,
      template: `
      <user>
         <first_name></first_name>
         <username></username>
         <preferences></preferences>
         <interests></interests>
         <conversation_style></conversation_style>
       </user>`,
    },
  },
});
```

And update the agent instructions to use this enhanced memory:

```typescript
export const personalAssistantAgent = new Agent({
  name: "Personal Assistant",
  instructions: `
    // ... existing instructions ...
    
    You have access to conversation memory and can remember details about users.
    When you learn something about a user, update their working memory using the appropriate tool.
    This includes:
    - Their interests
    - Their preferences
    - Their conversation style (formal, casual, etc.)
    - Any other relevant information that would help personalize the conversation

    Always maintain a helpful and professional tone.
    Use the stored information to provide more personalized responses.
  `,
  model: "openai/gpt-4.1-mini",
  tools: { ...mcpTools },
  memory,
});
```

This enhanced memory configuration gives your agent more sophisticated memory capabilities:

1. **Conversation History**: The `lastMessages` option keeps the last 20 messages in context, allowing your agent to reference recent conversations.

2. **Semantic Recall**: The `semanticRecall` option enables your agent to find relevant past conversations using semantic search, even if they happened a long time ago. For `semanticRecall` to work, you need to have a vector store and an embedder configured

3. **Working Memory**: The `workingMemory` option allows your agent to remember specific information about users, such as their preferences and interests, and use that information to provide more personalized responses.

By updating your agent's instructions to include information about these memory capabilities, you're helping it understand how to use them effectively to provide a better user experience.

## Step Quiz
**Questions**
1) What is the goal of enhancing memory configuration here?
**Answers**
1) To improve recall and personalization by tuning memory and vector settings.

<!-- STEP:31 -->
## Step 31: Conclusion

# Conclusion

Congratulations! You've successfully enhanced your Mastra agent with MCP servers, giving it powerful capabilities including:

1. Email and social media integration through Zapier
2. GitHub monitoring through the Composio GitHub MCP server
3. Tech news access through the Hacker News MCP server
4. Local file management through the Filesystem MCP server
5. Enhanced memory for personalized interactions

Your agent is now a versatile personal assistant that can help with a wide range of tasks. Feel free to experiment with different MCP servers and configurations to further enhance your agent's capabilities.

The power of MCP lies in its ability to connect your agent to a wide variety of external services and data sources without requiring you to write custom tool functions for each one. This modular approach makes it easy to add new capabilities to your agent as needed.

As you continue to develop your Mastra agent, consider exploring other MCP servers and tools that might be useful for your specific use case. The Mastra ecosystem is constantly growing, with new tools and capabilities being added regularly.

For more information on MCP and available servers, check out the [Mastra MCP documentation](https://mastra.ai/docs/agents/mcp-guide).

## Step Quiz
**Questions**
1) What is the main outcome of this lesson?
**Answers**
1) An agent that integrates multiple MCP servers with tested tools and improved memory.
